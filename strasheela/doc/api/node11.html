<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
 <head>
  <title>Midi</title>
  <style>BODY {
 background: url(page.gif) repeat-y white;
}
#slidemenubar, #slidemenubar2{
 position:absolute;
 left:-144px;
 width:160px;
 top:10px;
 border:0px solid black;
 font:bold 12px Verdana;
 line-height:10px;
}
.margin {
 position: absolute;
 left: 10px;
 width: 130px;
}
BODY, P, H1, H2, H3, A {
 font-family: sans-serif;
}
PRE, CODE {
 font-family: courier, monospace;
}
P {
 text-align: justify;
}
H1     { color: #9B0000; }
H2     { color: #FF9933; }
H3, H4 { color: #881155; }
CODE              { color: #663366; }
.code CODE        { color: #000000; }
SPAN.comment      { color: #B22222; }
SPAN.keyword      { color: #A020F0; }
SPAN.string       { color: #BC8F8F; }
SPAN.functionname { color: #0000FF; }
SPAN.type         { color: #228B22; }
SPAN.variablename { color: #B8860B; }
SPAN.reference    { color: #5F9EA0; }
SPAN.builtin      { color: #DA70D6; }
A:link {
 color: #666666;
}
A:visited {
 color: black;
}
A.pre { font-family: courier, monospace;
 color: #228B22;
}
</style>
 </head>
<body>
<script language="JavaScript1.2">
if (document.all)
document.write('<div id="slidemenubar2" style="left:-144" onMouseover="pull()" onMouseout="draw()">')
</script>
<layer id="slidemenubar" onMouseover="pull()" onMouseout="draw()">
<table border="0" cellpadding="0" cellspacing="0" width="161"><tr><td bgcolor="#009cff" width="144"><a href="index.html">Index</a>
</td><td rowspan="12" valign="top" width="16"><img src="menu.gif" width="16"></td></tr><tr><td bgcolor="#009cff" width="144"><a href="node1.html">Strasheela</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node2.html">Init</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node3.html">GUtils</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node4.html">LUtils</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node5.html">MUtils</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node6.html">Score</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node7.html">SMapping</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node8.html">SDistro</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node9.html">Out</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node10.html">Strasheela</a>
</td></tr><tr><td bgcolor="#009cff" width="144"><a href="node11.html">Midi</a>
</td></tr></table></layer>
<script language="JavaScript1.2">
function regenerate(){
window.location.reload()
}
function regenerate2(){
if (document.layers)
setTimeout("window.onresize=regenerate",400)
}
window.onload=regenerate2
if (document.all){
document.write('</div>')
themenu=document.all.slidemenubar2.style
rightboundary=0
leftboundary=-144
}
else{
themenu=document.layers.slidemenubar
rightboundary=144
leftboundary=0
}
function pull(){
if (window.drawit)
clearInterval(drawit)
pullit=setInterval("pullengine()",20)
}
function draw(){
clearInterval(pullit)
drawit=setInterval("drawengine()",50)
}
function pullengine(){
if (document.all&&themenu.pixelLeft<rightboundary)
themenu.pixelLeft+=5
else if(document.layers&&themenu.left<rightboundary)
themenu.left+=5
else if (window.pullit)
clearInterval(pullit)
}
function drawengine(){
if (document.all&&themenu.pixelLeft>leftboundary)
themenu.pixelLeft-=5
else if(document.layers&&themenu.left>leftboundary)
themenu.left-=5
else if (window.drawit)
clearInterval(drawit)
}
</script>

<div style="margin-left:160px"><span class="string">

<table border="0" cellpadding="2" cellspacing="2"><tr bgcolor="#eeeecc">




</tr></table>
<span class="string"> This functor defines means to output MIDI files. To this end, it makes use of csvmidi (see http://www.fourmilab.ch/webtools/midicsv/). A text file in midicsv file format is output which is transformed into a MIDI file by csvmidi.<BR>
<BR>
 The documentation of the lower-level functions in this functor often quotes the documentation of csvmidi for the csv / MIDI event the function creates.<BR>
<BR>
 General typing information:<BR>
<BR>
 Time: an integer representing the absolute time in MIDI clocks<BR>
 Channel: an integer in 0-15 (?)<BR>
 Track: an integer identifying the track to which this record belongs. Tracks of MIDI data are numbered starting at 1. Track 0 is reserved for file header, information, and end of file records.<BR>
 Text: an atom as 'my Text'<BR>
<BR>
<BR>
 Information on internals  <BR>
<BR>
 An intermediate format is used for the transformation process: on the Oz side, each record in the CSV representation is represented by an Oz record with label csv and the features track (an int), time (an int), and type (an atom). For exammple<BR>
<BR>
csv(track:1 time:0 type:'Start_track')<BR>
<BR>
 Additionally, a record may have feature parameters with a list of type-specific parameters, as in the following example (the note on parameters are [Channel Note Velocity]). <BR>
<BR>
csv(track:2 time:0 type:'Note_on_c' parameters:[1 79 81])<BR>
<BR>
 or this exammple (the controller parameters are [Channel ControlNum Value])<BR>
<BR>
csv(track:2 time:0 type:'Control_c' parameters:[1 7 64])<BR>
<BR>
 The feature values track and time and integers (see above). Type is a virtual string corresponding to a type in the CSV file format specification (see the end of http://www.fourmilab.ch/webtools/midicsv/). The parameters are a list of values permitted in a virtual string and follow the CSV specification. For example, a title record has the format (note the explicit double quotes, according to the CSV spec).<BR>
<BR>
csv(track:1 time:0 type:'Title_t' parameters:['\"This is my Title\"'])<BR>
<BR>
 An CSV score is represented internally by a list of these records.<BR>
<BR>
 See the CSV documentation (or the MidiOutput.oz source) for details on the various CSV types.<BR>
<BR>
<BR>
<BR>
<BR>
</span>
</span>
<h3>Functor</h3>
<ul>Midi ("<span class="string">/Users/t/oz/music/Strasheela/strasheela/trunk/strasheela/source/MidiOutput.oz</span>")<br></ul>
<h3>Import</h3>
<code><ul><li><a href="node3.html">GUtils</a> at "<span class="string">GeneralUtils.ozf"
</span></li><li><a href="node4.html">LUtils</a> at "<span class="string">ListUtils.ozf"
</span></li><li><a href="node9.html">Out</a> at "<span class="string">Output.ozf"
</span></li><li><a href="node2.html">Init</a> at "<span class="string">Init.ozf"
</span></li><li><a href="node6.html">Score</a> at "<span class="string">ScoreCore.ozf"
</span></li></ul></code>
<h3>Export</h3>
<code><ul><li>&lt;P/2:<a href="#entity563"><span class="functionname">OutputMidiFile</span></a>&gt;
</li><li>&lt;P/1:<a href="#entity564"><span class="functionname">PlayMidiFile</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity565"><span class="functionname">RenderAndPlayMidiFile</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity557"><span class="functionname">MakeCSVScore</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity562"><span class="functionname">ScoreToEvents_Midi</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity559"><span class="functionname">OutputCSVScore</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity560"><span class="functionname">OutputCSVScore2</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity558"><span class="functionname">CSVScoreToVS</span></a>&gt;
</li><li>&lt;P/1:<a href="#entity561"><span class="functionname">RenderMidiFile</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity567"><span class="functionname">MakeComment</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity568"><span class="functionname">MakeTitle</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity569"><span class="functionname">MakeCopyright</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity570"><span class="functionname">MakeInstrumentName</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity571"><span class="functionname">MakeMarker</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity572"><span class="functionname">MakeCuePoint</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity573"><span class="functionname">MakeLyric</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity574"><span class="functionname">MakeText</span></a>&gt;
</li><li>&lt;P/3:<a href="#entity575"><span class="functionname">MakeSequenceNumber</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity576"><span class="functionname">MakeMidiPort</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity577"><span class="functionname">MakeChannelPrefix</span></a>&gt;
</li><li>&lt;P/7:<a href="#entity578"><span class="functionname">MakeTimeSignature</span></a>&gt;
</li><li>&lt;P/5:<a href="#entity579"><span class="functionname">MakeKeySignature</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity580"><span class="functionname">MakeTempo</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity581"><span class="functionname">BeatsPerMinuteToTempoNumber</span></a>&gt;
</li><li>&lt;P/7:<a href="#entity582"><span class="functionname">MakeSMPTEOffset</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity583"><span class="functionname">MakeSequencerSpecific</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity584"><span class="functionname">MakeUnknownMetaEvent</span></a>&gt;
</li><li>&lt;P/6:<a href="#entity585"><span class="functionname">MakeNoteOn</span></a>&gt;
</li><li>&lt;P/6:<a href="#entity586"><span class="functionname">MakeNoteOff</span></a>&gt;
</li><li>&lt;P/5:<a href="#entity587"><span class="functionname">MakePitchBend</span></a>&gt;
</li><li>&lt;P/6:<a href="#entity588"><span class="functionname">MakeCC</span></a>&gt;
</li><li>&lt;P/5:<a href="#entity589"><span class="functionname">MakeProgramChange</span></a>&gt;
</li><li>&lt;P/5:<a href="#entity590"><span class="functionname">MakeChannelAftertouch</span></a>&gt;
</li><li>&lt;P/6:<a href="#entity591"><span class="functionname">MakePolyAftertouch</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity592"><span class="functionname">MakeSystemExclusive</span></a>&gt;
</li><li>&lt;P/4:<a href="#entity593"><span class="functionname">MakeSystemExclusivePacket</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity594"><span class="functionname">IsCSVEvent</span></a>&gt;
</li><li>&lt;P/3:<a href="#entity595"><span class="functionname">HasType</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity596"><span class="functionname">IsNoteOn</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity597"><span class="functionname">IsNoteOff</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity598"><span class="functionname">HasChannel</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity599"><span class="functionname">BeatsToTicks</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity600"><span class="functionname">TicksToBeats</span></a>&gt;
</li><li>&lt;C:<a href="#entity601"><span class="type">MidiNoteMixin</span></a>&gt;
</li><li>&lt;P/2:<a href="#entity602"><span class="functionname">IsMidiNoteMixin</span></a>&gt;
</li><li>&lt;C:<a href="#entity604"><span class="type">MidiNote</span></a>&gt;
</li><li>&lt;P/1:<a href="#entity566"><span class="functionname">SetDivision</span></a>&gt;
</li></ul></code>
<h3>Define</h3>

<code>
<a name="entity563">
<span class="keyword">proc</span>{<span class="functionname">OutputMidiFile</span> MyScore Spec}<br>
<span class="string"> Creates a MIDI file from MyScore as defined in Spec (see below). OutputMidiFile creates a CSV/MIDI file like an event list (i.e. only a single track is supported).<BR>
 The user can control the transformation process by specifing transformation clauses (cf. doc of Out.scoreToEvents). Each transformation function must return a list of Midi events. There must be only a single noteOn in the list of returned events and it must be coupled with a corresponding noteOff event (at least when removeQuestionableNoteoffs is set of true, which is recommended; see the doc of ScoreToEvents_Midi for the meaning of this option). Nevertheless, additional events (e.g. CC events) can be present in the same list. <BR>
 The argument clauses defaults to a transformation where only notes (either instances of Score.note, MidiNote, MidiNoteMixin or any subclasses) are considered for the MIDI file. <BR>
<BR>
 Spec defaults to <BR>
   unit(file:"test"<BR>
	csvDir:{Init.getStrasheelaEnv defaultCSVDir}<BR>
	midiDir:{Init.getStrasheelaEnv defaultMidiDir}<BR>
	csvExtension:".csv"<BR>
	midiExtension:".mid"<BR>
	flags:{Init.getStrasheelaEnv defaultCSVFlags}<BR>
	headerEvents:[local Track=2 in % fixed track<BR>
			 {MakeTempo Track 0<BR>
			  {BeatsPerMinuteToTempoNumber {FloatToInt {Init.getTempo}}}}<BR>
		      end]<BR>
	clauses:[isNote#fun {$ MyNote}<BR>
			   Track = 2 % fixed track<BR>
			   StartTime = {BeatsToTicks<BR>
					{MyNote getStartTimeInSeconds($)}}<BR>
			   EndTime = {BeatsToTicks<BR>
				      {MyNote getEndTimeInSeconds($)}}<BR>
			   Channel = if {IsMidiNoteMixin MyNote}<BR>
				     then {MyNote getChannel($)}<BR>
				     else 0 % default for all non-midi notes<BR>
				     end<BR>
			   Pitch = {FloatToInt {MyNote getPitchInMidi($)}}<BR>
			   Velocity = {FloatToInt {MyNote getAmplitudeInVelocity($)}}<BR>
			in<BR>
			   [{MakeNoteOn Track StartTime Channel Pitch Velocity}<BR>
			    {MakeNoteOff Track EndTime Channel Pitch 0}]<BR>
			end]<BR>
	removeQuestionableNoteoffs: true)<BR>
<BR>
 where the following variables are defined and exported by the present functor BeatsToTicks, IsMidiNoteMixin, MakeNoteOn and MakeNoteOff (e.g., they can be accessed as Out.midi.beatsToTicks, if the Output module is bound to Out).<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity564">
<span class="keyword">proc</span>{<span class="functionname">PlayMidiFile</span> Spec}<br>
<span class="string"> Plays a midi file with the player specified in {Init.getStrasheelaEnv midiPlayer} according Spec which defaults to<BR>
   unit(file:"test"<BR>
	midiDir:{Init.getStrasheelaEnv defaultMidiDir}<BR>
	midiExtension:".mid"<BR>
	flags:{Init.getStrasheelaEnv defaultMidiPlayerFlags})<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity565">
<span class="keyword">proc</span>{<span class="functionname">RenderAndPlayMidiFile</span> MyScore Spec}<br>
<span class="string"> Outputs MyScore into a MIDI file and starts the MIDI file player with this file. See OutputMidiFile and PlayMidiFile for documentation of the arguments expected by Spec.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity557">
<span class="keyword">fun</span>{<span class="functionname">MakeCSVScore</span> Events}<br>
<span class="string"> Returns a score in CSV format (a VS). Events is a list of MIDI event specs (created by one of the low-level MIDI event creators such as MakeNoteOn etc.).<BR>
 */<BR>
<BR>
    fun {MakeCSVScore Events}<BR>
 NTracks is the number of tracks in the file<BR>
       SortedEvents#NTracks = {MakeTracks Events}<BR>
 the MIDI file type (0, 1, or 2). Format 0 contains a single track and represents a single song performance. Format 1 may contain any number of tracks, enabling preservation of the sequencer track structure, and also represents a single song performance. Format 2 may have any number of tracks, each representing a separate song performance. Format 2 is not commonly supported by sequencers nor commonly found in the wild.<BR>
       Format = if NTracks == 1<BR>
 	       then 0<BR>
 	       else 1<BR>
 	       end<BR>
   /** %% Records in the CSV file are sorted first by the track number, then by time.<BR>
 */<BR>
   fun {MySort Tracks}<BR>
      {Flatten {Sort Tracks fun {$ X Y} X.1.track =< Y.1.track end}}<BR>
   end<BR>
       MyScore = {MakeComment "Created by Strasheela on "#{GUtils.timeVString}}<BR>
                  | {Map<BR>
 		    {MakeFileStart Format NTracks}<BR>
 		     | {Append SortedEvents [{MakeFileEnd}]}<BR>
 		    MakeEvent}<BR>
    in<BR>
       {Out.listToVS MyScore ""}<BR>
    end<BR>
<BR>
/** %% Expects a list of CSV records (e.g., each created by one of the low-level MIDI event creators such as MakeNoteOn etc.) and returns a full CSVScore in the internal CSV format described above.<BR>
 MakeCSVScore sorts the input events first by the track number, then by time. Also, it sorrounds all tracks by track start and end events, and surrounds the full score by a file header and end of file event. <BR>
 NB: In Events, the track number of all events must be >= 1. This means, the direct result of an import from a CSV file can not be used, because it already includes this header events.  <BR>
<BR>
</span>
</code><br>

<code>
<a name="entity562">
<span class="keyword">fun</span>{<span class="functionname">ScoreToEvents_Midi</span> MyScore Specs Args}<br>
<span class="string"> Variant of Out.scoreToEvents which deletes questionable note off events. In principle, multiple notes of the same channel and pitch can overlap in a Midi file. However, there is only a single note ressource and the second note will take over this ressource. What is more problematic, however, is the fact that the first note off event will turn off the note regardless whether the first of the second note was actually longer. ScoreToEvents_Midi avoids this problem by filtering out any note off event which would switch off a note too early. Nevertheless, this function can not change the fact that Midi provides only a single ressource per channel and pitch -- the 'taking over' of this ressource (e.g. restarting of the envelope) by overlapping notes can not be avoided.  <BR>
<BR>
</span>
</code><br>

<code>
<a name="entity559">
<span class="keyword">proc</span>{<span class="functionname">OutputCSVScore</span> Events Spec}<br>
<span class="string"> Outputs a CSV file. OutputCSVScore expects Events, a list of CSV records as expected by MakeCSVScore, and a specification of the output file which has the following defaults.<BR>
   unit(file:"test"<BR>
	csvDir:{Init.getStrasheelaEnv defaultCSVDir}<BR>
	csvExtension:".csv")<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity560">
<span class="keyword">proc</span>{<span class="functionname">OutputCSVScore2</span> Events Spec}<br>
<span class="string"> Outputs a CSV file. OutputCSVScore2 expects Events, a list of CSV records representing a full CSV score, including file and track header and end events. OutputCSVScore2 differs from OutputCSVScore in that OutputCSVScore adds those track header and end events. Spec has the following defaults.<BR>
   unit(file:"test"<BR>
	csvDir:{Init.getStrasheelaEnv defaultCSVDir}<BR>
	csvExtension:".csv")<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity558">
<span class="keyword">fun</span>{<span class="functionname">CSVScoreToVS</span> Events}<br>
<span class="string"> Expects a full CSVScore in the internal CSV format described above (e.g. as created by MakeCSVScore), and transforms it into a score in the textual CSV described by http://www.fourmilab.ch/webtools/midicsv/ (a VS). <BR>
<BR>
</span>
</code><br>

<code>
<a name="entity561">
<span class="keyword">proc</span>{<span class="functionname">RenderMidiFile</span> Spec}<br>
<span class="string"> Transforms a CSV file into a Midi file (by calling midicsv). The Spec defaults are the following.<BR>
   unit(file:"test"<BR>
	csvDir:{Init.getStrasheelaEnv defaultCSVDir}<BR>
	midiDir:{Init.getStrasheelaEnv defaultMidiDir}<BR>
	csvExtension:".csv"<BR>
	midiExtension:".mid"<BR>
	csvmidi:{Init.getStrasheelaEnv csvmidi}<BR>
 !!?? is flags control needed?<BR>
	flags:{Init.getStrasheelaEnv defaultCSVFlags})<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity567">
<span class="keyword">fun</span>{<span class="functionname">MakeComment</span> VS}<br>
<span class="string"> Expects a VS and returns a CSV comment, ending with a newline (a VS).<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity568">
<span class="keyword">fun</span>{<span class="functionname">MakeTitle</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text (an atom) specifies the title of the track or sequence. The first Title meta-event in a type 0 MIDI file, or in the first track of a type 1 file gives the name of the work. Subsequent Title meta-events in other tracks give the names of those tracks.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity569">
<span class="keyword">fun</span>{<span class="functionname">MakeCopyright</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text specifies copyright information for the sequence. This is usually placed at time 0 of the first track in the sequence.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity570">
<span class="keyword">fun</span>{<span class="functionname">MakeInstrumentName</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text names the instrument intended to play the contents of this track, This is usually placed at time 0 of the track. Note that this meta-event is simply a description; MIDI synthesisers are not required (and rarely if ever) respond to it. This meta-event is particularly useful in sequences prepared for synthesisers which do not conform to the General MIDI patch set, as it documents the intended instrument for the track when the sequence is used on a synthesiser with a different patch set.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity571">
<span class="keyword">fun</span>{<span class="functionname">MakeMarker</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text marks a point in the sequence which occurs at the given Time, for example '"Third Movement"'.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity572">
<span class="keyword">fun</span>{<span class="functionname">MakeCuePoint</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text identifies synchronisation point which occurs at the specified Time, for example, "Door slams".<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity573">
<span class="keyword">fun</span>{<span class="functionname">MakeLyric</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. The Text gives a lyric intended to be sung at the given Time. Lyrics are often broken down into separate syllables to time-align them more precisely with the sequence.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity574">
<span class="keyword">fun</span>{<span class="functionname">MakeText</span> Track Time Text}<br>
<span class="string"> Function returns a CSV event spec. This meta-event supplies an arbitrary Text string tagged to its Track at Time. It can be used for textual information which doesn't fall into one of the more specific categories given above.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity575">
<span class="keyword">fun</span>{<span class="functionname">MakeSequenceNumber</span> Track Number}<br>
<span class="string"> Function returns a CSV event spec. This meta-event specifies a sequence Number between 0 and 65535, used to arrange multiple tracks in a type 2 MIDI file, or to identify the sequence in which a collection of type 0 or 1 MIDI files should be played.<BR>
 The SequenceNumber meta-event should occur at the start of the track (at Time zero, implicitly set). <BR>
<BR>
</span>
</code><br>

<code>
<a name="entity576">
<span class="keyword">fun</span>{<span class="functionname">MakeMidiPort</span> Track Time Number}<br>
<span class="string"> Function returns a CSV event spec. This meta-event specifies that subsequent events in the Track should be sent to MIDI port (bus) Number, between 0 and 255. This meta-event usually appears at the start of a track with Time zero, but may appear within a track should the need arise to change the port while the track is being played.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity577">
<span class="keyword">fun</span>{<span class="functionname">MakeChannelPrefix</span> Track Time Number}<br>
<span class="string"> Function returns a CSV event spec. This meta-event specifies the MIDI channel that subsequent meta-events and system exclusive events pertain to. The channel Number specifies a MIDI channel from 0 to 15. In fact, the Number may be as large as 255, but the consequences of specifying a channel number greater than 15 are undefined.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity578">
<span class="keyword">fun</span>{<span class="functionname">MakeTimeSignature</span> Track Time Num Denom Click NotesQ}<br>
<span class="string"> Function returns a CSV event spec. The time signature (Num/Denom), metronome click rate, and number of 32nd notes per MIDI quarter note (24 MIDI clock times) are given by the numeric arguments. Num gives the numerator of the time signature as specified on sheet music. Denom specifies the denominator as a negative power of two, for example 2 for a quarter note, 3 for an eighth note, etc. Click gives the number of MIDI clocks per metronome click, and NotesQ the number of 32nd notes in the nominal MIDI quarter note time of 24 clocks (8 for the default MIDI quarter note definition).<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity579">
<span class="keyword">fun</span>{<span class="functionname">MakeKeySignature</span> Track Time Key MajorOrMinor}<br>
<span class="string"> Function returns a CSV event spec. The key signature is specified by the numeric Key value, which is 0 for the key of C, a positive value for each sharp above C, or a negative value for each flat below C, thus in the inclusive range -7 to 7. The MajorOrMinor argument is an atom which will be major for a major key and minor for a minor key.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity580">
<span class="keyword">fun</span>{<span class="functionname">MakeTempo</span> Track Time Number}<br>
<span class="string"> Function returns a CSV event spec. The tempo is specified as the Number of microseconds per quarter note, between 1 and 16777215. A value of 500000 corresponds to 120 quarter notes ("beats") per minute. To convert beats per minute to a Tempo value, take the quotient from dividing 60,000,000 by the beats per minute.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity581">
<span class="keyword">fun</span>{<span class="functionname">BeatsPerMinuteToTempoNumber</span> BeatsPerMinute}
</code><br>

<code>
<a name="entity582">
<span class="keyword">fun</span>{<span class="functionname">MakeSMPTEOffset</span> Track Hour Minute Second Frame FracFrame}<br>
<span class="string"> Function returns a CSV event spec. This meta-event, which must occur at the start of a track (with a zero Time, implicitly set), specifies the SMPTE time code at which it should start playing. The FracFrame field gives the fractional frame time (0 to 99).<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity583">
<span class="keyword">fun</span>{<span class="functionname">MakeSequencerSpecific</span> Track Time Parameters}<br>
<span class="string"> Function returns a CSV event spec. The SequencerSpecific meta-event is used to store vendor-proprietary data in a MIDI file. Parameters is a list of the form [Length Data ...]. <BR>
 The Length can be any value between 0 and (2^28)-1, specifying the number of Data bytes (between 0 and 255) which follow. Sequencer_specific records may be very long; programs which process MIDI CSV files should be careful to protect against buffer overflows and truncation of these records. <BR>
<BR>
</span>
</code><br>

<code>
<a name="entity584">
<span class="keyword">fun</span>{<span class="functionname">MakeUnknownMetaEvent</span> Track Time Parameters}<br>
<span class="string"> Function returns a CSV event spec. If midicsv encounters a meta-event with a code not defined by the standard MIDI file specification, it outputs an unknown meta-event. Parameters is a list of the form [Type Length Data ...]. <BR>
 Type gives the numeric meta-event type code, Length the number of data bytes in the meta-event, which can be any value between 0 and 228-1, followed by the Data bytes. Since meta-events include their own length, it is possible to parse them even if their type and meaning are unknown. csvmidi will reconstruct unknown meta-events with the same type code and content as in the original MIDI file.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity585">
<span class="keyword">fun</span>{<span class="functionname">MakeNoteOn</span> Track Time Channel Note Velocity}<br>
<span class="string"> Function returns a CSV event spec. Creates an event at Time (an int in MIDI clocks) to play the specified Note (an integer in range 0-127) on the given Channel (an int in 0-15 ?) with Velocity (an int in 0-127).<BR>
 A note on event with velocity zero is equivalent to a note off.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity586">
<span class="keyword">fun</span>{<span class="functionname">MakeNoteOff</span> Track Time Channel Note Velocity}<br>
<span class="string"> Function returns a CSV event spec. Creates an event at Time to stop playing the specified Note on the given Channel. The Velocity should be zero, but you never know what you'll find in a MIDI file.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity587">
<span class="keyword">fun</span>{<span class="functionname">MakePitchBend</span> Track Time Channel Value}<br>
<span class="string"> Function returns a CSV event spec. The pitch bend Value is a 14 bit unsigned integer and hence must be in the inclusive range from 0 to 16383.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity588">
<span class="keyword">fun</span>{<span class="functionname">MakeCC</span> Track Time Channel ControlNum Value}<br>
<span class="string"> Function returns a CSV event spec. Set the controller ControlNum (an int in 0-127) on the given Channel to the specified Value (an int in 0-127). The assignment of ControlNum values to effects differs from instrument to instrument. The General MIDI specification defines the meaning of controllers 1 (modulation), 7 (volume), 10 (pan), 11 (expression), and 64 (sustain), but not all instruments and patches respond to these controllers. Instruments which support those capabilities usually assign reverberation to controller 91 and chorus to controller 93.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity589">
<span class="keyword">fun</span>{<span class="functionname">MakeProgramChange</span> Track Time Channel ProgramNum}<br>
<span class="string"> Function returns a CSV event spec. Switch the specified Channel (0-15) to program (patch) ProgramNum (0-127). The program or patch selects which instrument and associated settings that channel will emulate. The General MIDI specification provides a standard set of instruments, but synthesisers are free to implement other sets of instruments and many permit the user to create custom patches and assign them to program numbers. <BR>
 Apparently due to instrument manufacturers' skepticism about musicians' ability to cope with the number zero, many instruments number patches from 1 to 128 rather than the 0 to 127 used within MIDI files. When interpreting ProgramNum values, note that they may be one less than the patch numbers given in an instrument's documentation.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity590">
<span class="keyword">fun</span>{<span class="functionname">MakeChannelAftertouch</span> Track Time Channel Value}<br>
<span class="string"> Function returns a CSV event spec. When a key is held down after being pressed, some synthesisers send the pressure, repeatedly if it varies, until the key is released, but do not distinguish pressure on different keys played simultaneously and held down. This is referred to as ``monophonic'' or ``channel'' aftertouch (the latter indicating it applies to the Channel as a whole, not individual note numbers on that channel). The pressure Value (0 to 127) is typically taken to apply to the last note played, but instruments are not guaranteed to behave in this manner.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity591">
<span class="keyword">fun</span>{<span class="functionname">MakePolyAftertouch</span> Track Time Channel Note Value}<br>
<span class="string"> Function returns a CSV event spec. Polyphonic synthesisers (those capable of playing multiple notes simultaneously on a single channel), often provide independent aftertouch for each note. This event specifies the aftertouch pressure Value (0 to 127) for the specified Note on the given Channel.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity592">
<span class="keyword">fun</span>{<span class="functionname">MakeSystemExclusive</span> Track Time Parameters}<br>
<span class="string"> Function returns a CSV event spec. System Exclusive events permit storing vendor-specific information to be transmitted to that vendor's products. Parameters is a list of the form [Length Data ...].<BR>
 The Length bytes of Data (0 to 255) are sent at the specified Time to the MIDI channel defined by the most recent Channel_prefix event on the Track, as a System Exclusive message. Note that Length can be any value between 0 and 228-1. Programs which process MIDI CSV files should be careful to protect against buffer overflows and truncation of these records.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity593">
<span class="keyword">fun</span>{<span class="functionname">MakeSystemExclusivePacket</span> Track Time Parameters}<br>
<span class="string"> Function returns a CSV event spec. System Exclusive events permit storing vendor-specific information to be transmitted to that vendor's products. Parameters is a list of the form [Length Data ...].<BR>
 The Length bytes of Data (0 to 255) are sent at the specified Time to the MIDI channel defined by the most recent Channel_prefix event on the Track. The Data bytes are simply blasted out to the MIDI bus without any prefix. This message is used by MIDI devices which break up long system exclusive message into small packets, spaced out in time to avoid overdriving their modest microcontrollers. Note that Length can be any value between 0 and 228-1. Programs which process MIDI CSV files should be careful to protect against buffer overflows and truncation of these records.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity594">
<span class="keyword">fun</span>{<span class="functionname">IsCSVEvent</span> X}<br>
<span class="string"> Returns true if X is a CSV event.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity595">
<span class="keyword">fun</span>{<span class="functionname">HasType</span> X Type}<br>
<span class="string"> Returns true if X is an CSV event of the given Type (an atom). X must be a CSV event.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity596">
<span class="keyword">fun</span>{<span class="functionname">IsNoteOn</span> X}<br>
<span class="string"> Returns true if X is an event of type 'Note_on_c'.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity597">
<span class="keyword">fun</span>{<span class="functionname">IsNoteOff</span> X}<br>
<span class="string"> Returns true if X is an event of type 'Note_off_c'.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity598">
<span class="keyword">fun</span>{<span class="functionname">HasChannel</span> X}<br>
<span class="string"> Returns true if events of the type X provides a channel as parameter.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity599">
<span class="keyword">fun</span>{<span class="functionname">BeatsToTicks</span> Beats}<br>
<span class="string"> Transforms a temporal value in beats (int or float) into the equivalent in MIDI ticks (int). The division is set by SetDivision.<BR>
<BR>
</span>
</code><br>

<code>
<a name="entity600">
<span class="keyword">fun</span>{<span class="functionname">TicksToBeats</span> Ticks}<br>
<span class="string"> Transforms a temporal value in MIDI ticks (int or float) into the equivalent beats (int). The division is set by SetDivision.<BR>
<BR>
</span>
</code><br>

<a name="entity601">
<p class="margin"><div align="right"><a href="class30.html">[class info]</a></div></p>
<code>

<table border="0" cellpadding="2" cellspacing="2"><tr bgcolor="#eeeecc">




</tr></table>
<span class="string"> Defines a mixin to extend the Score.note class (or any of its subclasses) to a full MIDI note class.<BR>
 MidiNoteMixin defines the additional attribute channel.<BR>
<BR>
</span>
<span class="keyword">class</span> <span class="type">MidiNoteMixin</span>
<br>&nbsp;&nbsp;&nbsp;<span class="keyword">feat</span>&nbsp;label&nbsp;!MidiNoteMixinType

<ul><li><span class="functionname">initMidiNote</span>(channel:Chan)<br>
</li><li><span class="functionname">getChannel</span>(X)<br>
</li><li><span class="functionname">getChannelParameter</span>(X)<br>
</li><li><span class="functionname">getMidiNoteMixinAttributes</span>(X)<br>
</li></ul>
<span class="keyword">end</span>
</code><br>

<code>
<a name="entity602">
<span class="keyword">fun</span>{<span class="functionname">IsMidiNoteMixin</span> X}
</code><br>

<a name="entity604">
<p class="margin"><div align="right"><a href="class31.html">[class info]</a></div></p>
<code>

<table border="0" cellpadding="2" cellspacing="2"><tr bgcolor="#eeeecc">




</tr></table>
<span class="string"> Extends Score.note by the additional attribute channel.<BR>
<BR>
</span>
<span class="keyword">class</span> <span class="type">MidiNote</span>&nbsp;<span class="keyword">from</span>&nbsp;<span class="reference"><a href="node6.html#entity242">Score.note</a></span>&nbsp;<a href="#entity601">MidiNoteMixin</a>
<br>&nbsp;&nbsp;&nbsp;<span class="keyword">feat</span>&nbsp;label

<ul><li><span class="functionname">init</span>(channel:Chan&nbsp;...)<br>
</li><li><span class="functionname">getAttributes</span>(X)<br>
</li><li><span class="functionname">toInitRecord</span>(X exclude:Excluded)<br>
</li></ul>
<span class="keyword">end</span>
</code><br>

<code>
<a name="entity566">
<span class="keyword">proc</span>{<span class="functionname">SetDivision</span> X}<br>
<span class="string"> Division (int) is the number of clock pulses per quarter note and is set in the MIDI file header. It defaults to 480.<BR>
 NB: I do not know whether there exists a maximum value for this (e.g. 960 seems not to work properly: it reduces notes of 1 beat to 0 beat!).<BR>
<BR>
</span>
</code><br>
<h3>End</h3>
</div></body>
</html>